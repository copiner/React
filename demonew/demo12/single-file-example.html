<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>LifeCycle</title>
  <script src="../com/react.development.js"></script>
  <script src="../com/react-dom.development.js"></script>
  <script src="../com/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
  class LifeCycle extends React.Component {
      constructor(props) {
          super(props);
          console.log("getDefaultProps");
          //对于每个组件实例来讲，这个方法只会调用一次，该组件类的所有后续应用，getDefaultPops 将不会再被调用，
          //其返回的对象可以用于设置默认的 props(properties的缩写)值。也可以在挂载组件的时候设置 props。
          this.state = {str: "Anna"};
          console.log("getInitialState");
          //对于组件的每个实例来说，这个方法的调用有且只有一次，用来初始化每个实例的 state，
          //在这个方法里，可以访问组件的 props。每一个React组件都有自己的 state，
          //其与 props 的区别在于 state只存在组件的内部，props 在所有实例中共享。
      }

      componentWillMount() {
          console.log("componentWillMount");
      }

      componentDidMount() {
          console.log("componentDidMount");
          //ReactDOM.findDOMNode()
      }

      componentWillReceiveProps(nextProps) {
          console.log("componentWillReceiveProps");
      }

      shouldComponentUpdate() {
          console.log("shouldComponentUpdate");
          return true;        // 记得要返回true
      }

      componentWillUpdate() {
          console.log("componentWillUpdate");
      }

      componentDidUpdate() {
          console.log("componentDidUpdate");
      }

      componentWillUnmount() {
          console.log("componentWillUnmount");
      }

      setTheState() {
          console.log("setTheState");
          let s = "Francisco";
          if (this.state.str === s) {
              s = "ANNA";
          }
          this.setState({
              str: s
          });
      }

      forceItUpdate() {
          console.log("forceItUpdate");
          this.forceUpdate();
      }

      render() {
          console.log("render");
          return(
              <div>
                  <div>{"Props:"}<h2>{parseInt(this.props.num)}</h2></div>
                  <div>{"State:"}<h2>{this.state.str}</h2></div>
              </div>
          );
      }
  }

  class Container  extends React.Component {
      constructor(props) {
          super(props);
          this.state = {
              num: Math.random() * 100
          };
      }

      propsChange() {
          console.log("propsChange");
          this.setState({
              num: Math.random() * 100
          });
      }

      stateChange() {
          console.log("setLifeCycleState");
          this.refs.rLifeCycle.setTheState();
      }

      lifeCycleUpdate() {
          console.log("forceLifeCycleUpdate");
          this.refs.rLifeCycle.forceItUpdate();
      }

      unmountLifeCycle() {
          // 这里卸载父组件也会导致卸载子组件
          console.log("unmountLifeCycle");
          ReactDOM.unmountComponentAtNode(document.getElementById("root"));
      }

      parentForceUpdate() {
          console.log("parentForceUpdate");
          // this.setState({
          //     num: Math.random() * 100
          // });
          this.forceUpdate();
      }

      render() {
          return (
            <div>
              <ol>
                <li><a href="javascript:;" onClick={this.propsChange.bind(this)}>propsChange</a></li>
                <li><a href="javascript:;" onClick={this.stateChange.bind(this)}>stateChange</a></li>
                <li><a href="javascript:;" onClick={this.lifeCycleUpdate.bind(this)}>lifeCycleUpdate</a></li>
                <li><a href="javascript:;" onClick={this.unmountLifeCycle.bind(this)}>unmountLifeCycle</a></li>
                <li><a href="javascript:;" onClick={this.parentForceUpdate.bind(this)}>parentForceUpdateWithoutChange</a></li>
              </ol>
                <LifeCycle ref="rLifeCycle" num={this.state.num} />
            </div>
          );
      }
  }

  ReactDOM.render(
    <Container />,
    document.getElementById('root')
  );

  </script>
</body>
</html>
